<form class="experiment-design" [formGroup]="experimentDesignForm">
  <!-- Condition table -->
  <ng-container>
    <mat-table
      class="condition-table"
      [dataSource]="conditionDataSource"
      formArrayName="conditions"
      #conditionTable
    >
      <!-- CONDITION NUMBER Column -->
      <ng-container matColumnDef="conditionNumber">
        <mat-header-cell *matHeaderCellDef>
          {{ 'global.number.text' | translate }}
        </mat-header-cell>
        <mat-cell *matCellDef="let element; let groupIndex = index">
          <span>{{ groupIndex + 1 }}</span>
        </mat-cell>
      </ng-container>

      <!-- UNIQUE IDENTIFIER Column -->
      <ng-container matColumnDef="uniqueIdentifier">
        <mat-header-cell *matHeaderCellDef>
          {{ 'home.new-experiment.design.unique-identifier.text' | translate }}
        </mat-header-cell>
        <mat-cell *matCellDef="let element; let groupIndex = index" [formGroupName]="groupIndex">
          <mat-form-field floatLabel="never">
            <input
              matInput
              formControlName="twoCharacterId"
              readonly
            />
          </mat-form-field>
        </mat-cell>
      </ng-container>

      <!-- CONDITION NAME Column -->
      <ng-container matColumnDef="conditionCode">
        <mat-header-cell *matHeaderCellDef>
          {{ 'home-global.condition.text' | translate }}
        </mat-header-cell>
        <mat-cell
          *matCellDef="let element; let groupIndex = index"
          [formGroupName]="groupIndex"
        >
          <mat-form-field floatLabel="never">
            <input
              matInput
              [placeholder]="
                'home.new-experiment.design.condition.placeholder.text'
                  | translate
              "
              formControlName="conditionCode"
              #conditionCode
            />
          </mat-form-field>
        </mat-cell>
      </ng-container>

      <!-- ASSIGNMENT WEIGHT Column -->
      <ng-container matColumnDef="assignmentWeight">
        <mat-header-cell *matHeaderCellDef>
          {{ 'home-global.assignment-weight.text' | translate }}
        </mat-header-cell>
        <mat-cell
          *matCellDef="let element; let groupIndex = index"
          [formGroupName]="groupIndex"
        >
          <mat-form-field floatLabel="never">
            <input
              type="number"
              matInput
              [placeholder]="
                'home.new-experiment.design.assignment-weight.placeholder.text'
                  | translate
              "
              formControlName="assignmentWeight"
            />
          </mat-form-field>
        </mat-cell>
      </ng-container>

      <!-- DESCRIPTION Column -->
      <ng-container matColumnDef="description">
        <mat-header-cell *matHeaderCellDef>
          {{ 'home.new-experiment.design.description.text' | translate }}
        </mat-header-cell>
        <mat-cell
          *matCellDef="let element; let groupIndex = index"
          [formGroupName]="groupIndex"
        >
          <mat-form-field floatLabel="never">
            <input
              matInput
              [placeholder]="
                'home.new-experiment.design.description.placeholder.text'
                  | translate
              "
              formControlName="description"
            />
          </mat-form-field>
        </mat-cell>
      </ng-container>

      <ng-container matColumnDef="removeCondition">
        <mat-header-cell *matHeaderCellDef></mat-header-cell>
        <mat-cell
          *matCellDef="let element; let groupIndex = index"
          [formGroupName]="groupIndex"
        >
          <app-shared-icons
            [iconType]="'delete'"
            class="remove-icon"
            *ngIf="groupIndex !== 0 && groupIndex !== 1"
            (click)="removeConditionOrPartition('condition', groupIndex, element.controls.twoCharacterId.value)"
          ></app-shared-icons>
        </mat-cell>
      </ng-container>

      <mat-header-row
        *matHeaderRowDef="conditionDisplayedColumns; sticky: true"
      ></mat-header-row>
      <mat-row
        *matRowDef="let row; columns: conditionDisplayedColumns"
      ></mat-row>
    </mat-table>
    <span
      class="validation-message"
      *ngIf="experimentDesignForm.errors?.assignmentWightsSumError && isAssignmentWeightControlDirty"
      [innerHTML]="'home.new-experiment.design.assignment-weight-validation.text' | translate"
    ></span>
    <button
      type="button"
      class="add-condition"
      (click)="addConditionOrPartition('condition')"
    >
      + {{ 'home.new-experiment.design.add-condition.text' | translate }}
    </button>
  </ng-container>

  <!-- Partition Table -->
  <ng-container>
    <mat-table
      class="partition-table"
      [dataSource]="partitionDataSource"
      formArrayName="partitions"
      #partitionTable
    >

     <!-- PARTITION NUMBER Column -->
     <ng-container matColumnDef="partitionNumber">
      <mat-header-cell *matHeaderCellDef>
        {{ 'global.number.text' | translate }}
      </mat-header-cell>
      <mat-cell *matCellDef="let element; let groupIndex = index">
        <span>{{ groupIndex + 1 }}</span>
      </mat-cell>
    </ng-container>

    <!-- UNIQUE IDENTIFIER Column -->
    <ng-container matColumnDef="uniqueIdentifier">
      <mat-header-cell *matHeaderCellDef>
        {{ 'home.new-experiment.design.unique-identifier.text' | translate }}
      </mat-header-cell>
      <mat-cell *matCellDef="let element; let groupIndex = index" [formGroupName]="groupIndex">
        <mat-form-field floatLabel="never">
          <input
            matInput
            formControlName="twoCharacterId"
            readonly
          />
        </mat-form-field>
      </mat-cell>
    </ng-container>

      <!-- PARTITION POINT Column -->
      <ng-container matColumnDef="point">
        <mat-header-cell *matHeaderCellDef>
          {{ 'home.new-experiment.design.partition-point.text' | translate }}
        </mat-header-cell>
        <mat-cell
          *matCellDef="let element; let groupIndex = index"
          [formGroupName]="groupIndex"
        >
          <mat-form-field floatLabel="never">
            <input
              matInput
              [placeholder]="
                'home.new-experiment.design.partition-point.placeholder.text'
                  | translate
              "
              formControlName="point"
            />
          </mat-form-field>
        </mat-cell>
      </ng-container>

      <!-- ID Column -->
      <ng-container matColumnDef="name">
        <mat-header-cell *matHeaderCellDef>
          {{ 'home.new-experiment.design.partition-id.text' | translate }}
        </mat-header-cell>
        <mat-cell
          *matCellDef="let element; let groupIndex = index"
          [formGroupName]="groupIndex"
        >
          <mat-form-field floatLabel="never">
            <input
              matInput
              [placeholder]="
                'home.new-experiment.design.partition-id.placeholder.text'
                  | translate
              "
              formControlName="name"
            />
          </mat-form-field>
        </mat-cell>
      </ng-container>

      <ng-container matColumnDef="removePartition">
        <mat-header-cell *matHeaderCellDef></mat-header-cell>
        <mat-cell
          *matCellDef="let element; let groupIndex = index"
          [formGroupName]="groupIndex"
        >
          <app-shared-icons
            [iconType]="'delete'"
            class="remove-icon"
            *ngIf="groupIndex !== 0"
            (click)="removeConditionOrPartition('partition', groupIndex, element.controls.twoCharacterId.value)"
          ></app-shared-icons>
        </mat-cell>
      </ng-container>

      <mat-header-row
        *matHeaderRowDef="partitionDisplayedColumns; sticky: true"
      ></mat-header-row>
      <mat-row *matRowDef="let row; columns: partitionDisplayedColumns"></mat-row>
    </mat-table>
    <button
      type="button"
      class="add-partition"
      (click)="addConditionOrPartition('partition')"
    >
      +
      {{ 'home.new-experiment.design.add-point-and-partition.text' | translate }}
    </button>
  </ng-container>

  <span
    class="validation-message"
    *ngFor="let error of partitionPointErrors"
  >{{ error }} </span>

  <div class="button-container">
    <button
      matStepperPrevious
      mat-raised-button
      class="default-button"
    >
      {{ 'global.back.text' | translate }}
    </button>
    <div>
      <button
        mat-raised-button
        (click)="emitEvent(NewExperimentDialogEvents.CLOSE_DIALOG)"
      >
        {{ 'global.cancel.text' | translate }}
      </button>
      <button
        mat-raised-button
        class="default-button"
        (click)="emitEvent(NewExperimentDialogEvents.SEND_FORM_DATA)"
      >
        {{ 'global.next.text' | translate }}
      </button>
    </div>
  </div>
</form>
