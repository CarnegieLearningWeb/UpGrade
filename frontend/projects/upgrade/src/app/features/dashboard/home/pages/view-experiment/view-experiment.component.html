<mat-card class="experiment-container" *ngIf="experiment">
  <span class="ft-16-400">
    <a [routerLink]="['/home']" class="ft-16-400 experiment-link"
      >{{ 'home.view-experiment.experiments.text' | translate }}
    </a>
    <b> {{ experiment?.name }} </b>
  </span>
  <mat-card class="experiment">
    <div class="experiment-info">
      <div class="experiment-overview">
        <span class="ft-32-700 experiment-overview-title">
          {{ experiment?.name }}
          <span class="ft-16-400 experiment-overview-partitions">
            (
            {{
              experiment.partitions?.length +
                ' ' +
                ('home.view-experiment.experiments-decision-points.text' | translate)
            }}
            )
          </span>
        </span>

        <div class="action-buttons">
          <button
            mat-flat-button
            class="ft-14-600 button"
            (click)="openDialog(DialogType.EDIT_EXPERIMENT)"
            *ngIf="permissions?.experiments.update && experiment.state !== ExperimentState.CANCELLED"
          >
            {{ 'home.view-experiment.edit-button.text' | translate }}
          </button>
          <!-- <button mat-flat-button class="ft-14-600 button button--query" (click)="openQueriesModal()">
            {{ 'global.monitor.text' | translate | uppercase }}
          </button> -->
          <button
            mat-flat-button
            class="ft-14-600 button"
            (click)="deleteExperiment()"
            *ngIf="permissions?.experiments.delete"
          >
            {{ 'global.delete.text' | translate }}
          </button>
          <button mat-flat-button class="ft-14-600 button" (click)="openExportModal()">
            {{ 'home.view-experiment.export-button.text' | translate }}
          </button>
        </div>
      </div>

      <span class="ft-16-400 experiment-description">
        {{ experiment.description }}
      </span>

      <div class="experiment-overview">
        <span class="ft-32-700 experiment-overview-dates">
          <span class="ft-14-700 experiment-overview-create-date">
            {{
              ('home.view-experiment.created-on.text' | translate) + (experiment.createdAt | formatDate: 'medium date')
            }}
          </span>

          <span class="ft-14-700 experiment-overview-last-update-date">
            {{
              ('home.view-experiment.last-updated-on.text' | translate) +
                (experiment.updatedAt | formatDate: 'medium date')
            }}
          </span>
        </span>

        <!-- <div class="action-buttons">
          <button mat-flat-button class="ft-14-600 button-long" (click)="viewParticipantsData()">
            <mat-icon class="icon">list</mat-icon>
            {{ 'home.view-experiment.view-participants-data-button.text' | translate }}
          </button>
        </div> -->
      </div>
    </div>

    <mat-tab-group [selectedIndex]="0" disableRipple>
      <mat-tab label="{{ 'home.view-experiment.mattab.overview.text' | translate }}">
        <div class="experiment-secondary-info tab-body-container">
          <div class="experiment-secondary-info-container">
            <div class="experiment-info-section">
              <!-- Experiment status  -->
              <div class="section-data section-data--fixed">
                <span class="ft-16-600 section-data-title">{{ 'home-global.status.text' | translate }}</span>
                <div class="experiment-state-container">
                  <ng-container
                    *ngIf="
                      experiment.state === ExperimentState.PREVIEW ||
                        experiment.state === ExperimentState.CANCELLED ||
                        experiment.state === ExperimentState.SCHEDULED;
                      else experimentStateTemplate
                    "
                  >
                    <app-shared-icons class="icons" [iconType]="experiment.state"></app-shared-icons>
                  </ng-container>
                  <ng-template #experimentStateTemplate>
                    <span
                      class="state-circle"
                      [ngStyle]="{
                        backgroundColor: experiment.state | experimentState: ExperimentStatePipeTypes.COLOR
                      }"
                    ></span>
                  </ng-template>
                  <ng-container
                    *ngIf="
                      permissions?.experiments.update && experiment.state !== ExperimentState.CANCELLED;
                      else readOnlyStatus
                    "
                  >
                    <span
                      class="ft-18-700 section-data-value section-data-value--editable"
                      (click)="openDialog(DialogType.CHANGE_STATUS)"
                    >
                      {{ experiment.state | experimentState }}
                    </span>
                    <mat-icon class="edit-icon">create</mat-icon>
                  </ng-container>
                  <ng-template #readOnlyStatus>
                    <span class="ft-18-700 section-data-value">{{ experiment.state | experimentState }}</span>
                  </ng-template>
                </div>
              </div>

              <!-- Experiment post experiment rule -->
              <div class="section-data">
                <span class="ft-16-600 section-data-title">{{
                  'home-global.post-experiment-rule.text' | translate
                }}</span>
                <div class="experiment-state-container post-experiment-rule-container">
                  <ng-container
                    *ngIf="
                      permissions?.experiments.update && experiment.state !== ExperimentState.CANCELLED;
                      else readOnlyRule
                    "
                  >
                    <div class="section-data-value section-data-value--editablediv">
                      <span
                        class="ft-18-700 section-data-value section-data-value--editable"
                        (click)="openDialog(DialogType.CHANGE_POST_EXPERIMENT_RULE)"
                        >{{ experiment.postExperimentRule | titlecase }}</span
                      >
                      <mat-icon class="edit-icon" *ngIf="permissions?.experiments.update">create</mat-icon>
                    </div>
                    <span
                      class="ft-14-400 experiment-assign"
                      *ngIf="
                        experiment.postExperimentRule === ('home-global.post-experiment-rule.assign.text' | translate)
                      "
                    >
                      {{
                        experiment.revertTo
                          ? getConditionCode(experiment.revertTo, experiment.id)
                          : '(' + ('home-global.post-experiment-rule.default.text' | translate) + ')'
                      }}
                    </span>
                  </ng-container>
                  <ng-template #readOnlyRule>
                    <span class="ft-18-700 section-data-value">{{ experiment.postExperimentRule | titlecase }}</span>
                    <br />
                    <span
                      class="ft-14-400 experiment-assign"
                      *ngIf="
                        experiment.postExperimentRule === ('home-global.post-experiment-rule.assign.text' | translate)
                      "
                    >
                      {{
                        experiment.revertTo
                          ? getConditionCode(experiment.revertTo, experiment.id)
                          : '(' + ('home-global.post-experiment-rule.default.text' | translate) + ')'
                      }}
                    </span>
                  </ng-template>
                </div>
              </div>
            </div>

            <div class="experiment-info-section">
              <!-- Experiment Unit of assignment -->
              <div class="section-data section-data--fixed">
                <span class="ft-16-600 section-data-title"
                  >{{ 'home-global.unit-of-assignment.text' | translate | uppercase }}
                </span>
                <span class="ft-18-700 section-data-value">{{ experiment.assignmentUnit | titlecase }}</span>
                <ng-container *ngIf="experiment.group">
                  <span
                    class="ft-12-400 section-data-group"
                    *ngIf="experiment.group?.length < 30; else experimentGroupTruncate"
                  >
                    {{ '( ' + experiment.group + ' )' }}
                  </span>
                  <ng-template #experimentGroupTruncate>
                    <span
                      class="ft-12-400 section-data-group"
                      [matTooltip]="experiment.group"
                      matTooltipPosition="above"
                    >
                      {{ '( ' + (experiment.group | truncate: 35) + ' )' }}
                    </span>
                  </ng-template>
                </ng-container>
              </div>

              <!-- Experiment consistency rule OR Experiment condition Order -->
              <div class="section-data">
                <span 
                  class="ft-16-600 section-data-title"
                  *ngIf="experiment.consistencyRule; else withinSubject"
                >
                  {{ 'home-global.consistency-rule.text' | translate | uppercase }}
                </span>
                <ng-template #withinSubject>
                  <span class="ft-16-600 section-data-title">
                    {{ 'home-global.condition-order.text' | translate | uppercase }}
                  </span>
                </ng-template>
                <span class="ft-18-700 section-data-value">{{ experiment.consistencyRule || experiment.conditionOrder | titlecase }}</span>
              </div>
            </div>

            <div class="experiment-info-section">
              <div class="section-data section-data--fixed end-criteria-container">
                <span class="ft-16-600 section-data-title">{{
                  'home.view-experiment.ending-criteria.text' | translate
                }}</span>
                <ng-container
                  *ngIf="experiment.endOn || experiment.enrollmentCompleteCondition; else noCriteriaTemplate"
                >
                  <!-- if we have custom ending criteria -->
                  <ng-container *ngIf="experiment.enrollmentCompleteCondition as endCondition">
                    <span class="ft-18-700 end-criteria end-criteria--text"> ( </span>
                    <span
                      *ngIf="
                        permissions?.experiments.update && !isExperimentStateCancelled;
                        else endingCriteriaCommonTempReadOnly
                      "
                      (click)="updateEndingCriteria()"
                      [ngClass]="{ 'end-criteria-underline--blue': permissions?.experiments.update }"
                    >
                      <ng-container *ngTemplateOutlet="endingCriteriaCommonTemp"></ng-container>
                    </span>

                    <ng-template #endingCriteriaCommonTempReadOnly>
                      <ng-container *ngTemplateOutlet="endingCriteriaCommonTemp"></ng-container>
                    </ng-template>

                    <!-- Common ending criteria template -->
                    <ng-template #endingCriteriaCommonTemp>
                      <span
                        class="ft-18-700 end-criteria end-criteria--data end-criteria--text"
                        *ngIf="endCondition?.groupCount as groupCount"
                      >
                        {{ groupCount + ' ' }}
                        <span *ngIf="groupCount < 2; else groupTypePlural">
                          {{ 'global.group-type-singular.text' | translate: { groupType: experiment.group } }}
                        </span>
                        <ng-template #groupTypePlural>
                          <span>{{
                            'global.group-type-plural.text' | translate: { groupType: experiment.group }
                          }}</span>
                        </ng-template>
                      </span>
                      <span
                        class="ft-18-700 end-criteria end-criteria--text"
                        *ngIf="endCondition?.userCount && endCondition.groupCount"
                      >
                        {{ 'home.view-experiment.ending-criteria.and.text' | translate }}
                      </span>
                      <span
                        class="ft-18-700 end-criteria end-criteria--data end-criteria--text"
                        *ngIf="endCondition?.userCount as studentCount"
                      >
                        {{ studentCount + ('home.view-experiment.ending-criteria.students.text' | translate) }}
                      </span>
                      <span
                        class="ft-18-700 end-criteria end-criteria--data end-criteria--text"
                        *ngIf="endCondition?.groupCount && endCondition?.userCount"
                      >
                        {{ ('home-global.enrollments-per-custom.text' | translate) + experiment.group }}
                      </span>
                    </ng-template>

                    <span class="ft-18-700 end-criteria end-criteria--text"> ) </span>
                    <mat-icon class="edit-icon" *ngIf="permissions?.experiments.update && !isExperimentStateCancelled">
                      create
                    </mat-icon>
                  </ng-container>

                  <!-- if we have end date -->
                  <span class="ft-18-700 end-criteria" *ngIf="experiment.endOn">
                    <ng-container
                      *ngIf="permissions?.experiments.update && !isExperimentStateCancelled; else endOnReadOnly"
                    >
                      <span class="end-criteria-underline--grey" (click)="updateEndingCriteria()">
                        {{ experiment.endOn | formatDate: 'medium date' }}
                      </span>
                      <mat-icon class="edit-icon">create</mat-icon>
                    </ng-container>

                    <ng-template #endOnReadOnly>
                      <span>{{ experiment.endOn | formatDate: 'medium date' }}</span>
                    </ng-template>
                  </span>
                </ng-container>

                <!-- Show template if ending criteria is not set -->
                <ng-template #noCriteriaTemplate>
                  <span
                    class="ft-18-700 end-criteria"
                    *ngIf="
                      permissions?.experiments.update && !isExperimentStateCancelled;
                      else noCriteriaTemplateReadOnly
                    "
                  >
                    <span (click)="updateEndingCriteria()" class="end-criteria-underline--grey">
                      {{ 'home.view-experiment.ending-criteria.no-criteria.text' | translate }}
                    </span>
                    <mat-icon class="edit-icon">create</mat-icon>
                  </span>
                </ng-template>
                <ng-template #noCriteriaTemplateReadOnly>
                  <span class="ft-18-700 end-criteria">{{
                    'home.view-experiment.ending-criteria.no-criteria.text' | translate
                  }}</span>
                </ng-template>
              </div>

              <!-- ExcludeIfReached Column -->
              <ng-container matColumnDef="excludeIfReached">
                <mat-header-cell class="ft-12-700" *matHeaderCellDef>
                  {{ 'home.new-experiment.design.exclude-if-reached.text' | translate }}
                </mat-header-cell>
                <mat-cell *matCellDef="let data; let groupIndex = index" style="margin-left: 25px">
                  <mat-checkbox class="ft-8-100" color="primary" [checked]="data.excludeIfReached" [disabled]="true">
                  </mat-checkbox>
                </mat-cell>
              </ng-container>

              <!-- Enrollment Time Logs -->
              <div class="section-data section-data">
                <span class="ft-16-600 section-data-title">
                  {{ 'home.view-experiment.enrollment-time-logs.title.text' | translate | uppercase }}
                </span>
                <span
                  class="ft-18-700 section-data-value section-data-value--editable"
                  (click)="openDialog(DialogType.STATE_TIME_LOGS)"
                >
                  {{ 'home.view-experiment.enrollment-time-logs.text' | translate }}
                </span>
              </div>
            </div>
          </div>

          <!-- Experiment Context -->
          <div class="experiment-chips">
            <span class="ft-16-600 experiment-chips-title">{{ 'global.context.text' | translate }}</span>
            <div class="experiment-chips-values">
              <span
                class="ft-14-400"
                (click)="searchExperiment(ExperimentSearchKey.CONTEXT, context)"
                *ngFor="let context of experiment.context"
              >
                {{ context }}
              </span>
            </div>
          </div>

          <!-- Experiment Tags -->
          <div class="experiment-chips" *ngIf="experiment.tags?.length">
            <span class="ft-16-600 experiment-chips-title">{{ 'global.tags.text' | translate }}</span>
            <div class="experiment-chips-values">
              <span
                class="ft-14-400"
                (click)="searchExperiment(ExperimentSearchKey.TAG, tag)"
                *ngFor="let tag of experiment.tags"
              >
                {{ tag }}
              </span>
            </div>
          </div>

          <!-- Logging -->
          <div class="logging">
            <mat-checkbox
              [checked]="experiment.logging"
              class="ft-16-600"
              color="primary"
              (change)="toggleVerboseLogging($event)"
            >
              {{ 'home.view-experiment.logging.text' | translate | uppercase }}
            </mat-checkbox>
          </div>
        </div>
      </mat-tab>

      <mat-tab label="{{ 'home.view-experiment.mattab.design.text' | translate }}">
        <div class="tab-body-container tab-table-body-container">
          <!-- Experiment Decision Points Table -->
          <div class="table-container table-container-partition">
            <span class="ft-24-700">{{ 'home.view-experiment.experiment-decision-point-title.text' | translate }}</span>
            <mat-table [dataSource]="experiment.partitions" class="table">
              <!-- Site Column -->
              <ng-container matColumnDef="partitionPoint">
                <mat-header-cell class="ft-12-700" *matHeaderCellDef>
                  {{ 'home.view-experiment-global.experiment-site.text' | translate }}
                </mat-header-cell>
                <mat-cell class="ft-12-600" *matCellDef="let data">
                  <span *ngIf="data.site?.length < 50; else partitionPoint">
                    {{ data.site }}
                  </span>
                  <ng-template #partitionPoint>
                    <span [matTooltip]="data.site" matTooltipPosition="above">
                      {{ data.site | truncate: 50 }}
                    </span>
                  </ng-template>
                </mat-cell>
              </ng-container>

              <!-- Target Column -->
              <ng-container matColumnDef="partitionId">
                <mat-header-cell class="ft-12-700" *matHeaderCellDef>
                  {{ 'home.view-experiment-global.experiment-target.text' | translate }}
                </mat-header-cell>
                <mat-cell class="ft-12-600" *matCellDef="let data">
                  <span *ngIf="data.target?.length < 50; else partitionName">
                    {{ data.target }}
                  </span>
                  <ng-template #partitionName>
                    <span [matTooltip]="data.target" matTooltipPosition="above">
                      {{ data.target | truncate: 50 }}
                    </span>
                  </ng-template>
                </mat-cell>
              </ng-container>

              <!-- ExcludeIfReached Column -->
              <ng-container matColumnDef="excludeIfReached">
                <mat-header-cell class="ft-12-700" *matHeaderCellDef>
                  {{ 'home.new-experiment.design.exclude-if-reached.text' | translate }}
                </mat-header-cell>
                <mat-cell *matCellDef="let data; let groupIndex = index" style="margin-left: 25px">
                  <mat-checkbox class="ft-8-100" color="primary" [checked]="data.excludeIfReached" [disabled]="true">
                  </mat-checkbox>
                </mat-cell>
              </ng-container>
              <mat-header-row *matHeaderRowDef="displayedPartitionColumns"></mat-header-row>
              <mat-row *matRowDef="let row; columns: displayedPartitionColumns"></mat-row>
            </mat-table>
            <div *ngIf="experiment.type === 'Factorial'">
              <br />
              <br />
              <br />
              <span class="ft-24-700">{{ 'home.new-experiment.design.factor.text' | translate }}</span>
              <mat-table class="factor-table" [dataSource]="factorsDataSource" multiTemplateDataRows>
                <!-- Expand Icon Column -->
                <ng-container matColumnDef="expandIcon">
                  <mat-header-cell class="ft-14-700" *matHeaderCellDef></mat-header-cell>
                  <mat-cell *matCellDef="let data; let factorIndex = dataIndex" style="justify-content: flex-start">
                    <mat-icon [class.active]="factorIndex === expandedId" (click)="expandFactor(factorIndex)"
                      >play_arrow</mat-icon
                    >
                  </mat-cell>
                </ng-container>

                <!-- Factor Column -->
                <ng-container matColumnDef="factorName">
                  <mat-header-cell class="ft-12-700" *matHeaderCellDef>
                    {{ 'home.new-experiment.design.factor-name.text' | translate }}
                  </mat-header-cell>
                  <mat-cell class="ft-12-600" *matCellDef="let data; let factorIndex = dataIndex">
                    <span *ngIf="data.factor?.length < 50; else factorName">
                      {{ data.factor }}
                    </span>
                    <ng-template #factorName>
                      <span [matTooltip]="data.factor" matTooltipPosition="above">
                        {{ data.factor | truncate: 50 }}
                      </span>
                    </ng-template>
                  </mat-cell>
                </ng-container>

                <!-- Description Column -->
                <ng-container matColumnDef="description">
                  <mat-header-cell class="ft-12-700" *matHeaderCellDef>
                    {{ 'home.view-experiment-global.description.text' | translate }}
                  </mat-header-cell>
                  <mat-cell class="ft-12-600" *matCellDef="let data; let factorIndex = dataIndex">
                    <span *ngIf="data.description?.length < 50; else descriptionTrimmed">
                      {{ data.description }}
                    </span>
                    <ng-template #descriptionTrimmed>
                      <span [matTooltip]="data.description" matTooltipPosition="above">
                        {{ data.description | truncate: 50 }}
                      </span>
                    </ng-template>
                  </mat-cell>
                </ng-container>

                <!-- EXPANDABLE ROW -->
                <ng-container matColumnDef="expandedDetail">
                  <mat-cell *matCellDef="let data; let factorIndex = dataIndex">
                    <div *ngIf="factorIndex === expandedId" class="level-table-container">
                      <mat-table class="table level-table" [dataSource]="data.levels">
                        <!-- Level Column -->
                        <ng-container matColumnDef="level">
                          <mat-header-cell class="ft-14-700" *matHeaderCellDef>
                            {{ 'home.new-experiment.design.level-name.text' | translate }}
                          </mat-header-cell>
                          <mat-cell *matCellDef="let data; let levelIndex = index">
                            <span>{{ data.name }}</span>
                          </mat-cell>
                        </ng-container>

                        <!-- Payload Column -->
                        <ng-container matColumnDef="payload">
                          <mat-header-cell class="ft-14-700" *matHeaderCellDef>
                            {{ 'home.new-experiment.design.payloads.column-header.payload.text' | translate }}
                          </mat-header-cell>
                          <mat-cell *matCellDef="let data; let levelIndex = index">
                            <span>{{ data.payload?.value }}</span>
                          </mat-cell>
                        </ng-container>

                        <mat-header-row
                          *matHeaderRowDef="displayedPartitionLevelColumnsFactorial; sticky: true"
                        ></mat-header-row>
                        <mat-row *matRowDef="let row; columns: displayedPartitionLevelColumnsFactorial"></mat-row>
                      </mat-table>
                    </div>
                  </mat-cell>
                </ng-container>

                <mat-header-row *matHeaderRowDef="displayedPartitionColumnsFactorial; sticky: true"></mat-header-row>
                <mat-row *matRowDef="let row; columns: displayedPartitionColumnsFactorial"></mat-row>
                <mat-row class="expandable-row" *matRowDef="let row; columns: ['expandedDetail']"> </mat-row>
              </mat-table>
            </div>
          </div>

          <!-- Experiment Conditions Table -->
          <div class="table-container table-container-partition">
            <span class="ft-24-700">{{ 'home.view-experiment.experiment-conditions-title.text' | translate }}</span>
            <div *ngIf="experiment.type === 'Simple'">
              <mat-table [dataSource]="experiment.conditions" class="table">
                <!-- Condition Code Column -->
                <ng-container matColumnDef="conditionCode">
                  <mat-header-cell class="ft-12-700" *matHeaderCellDef>
                    {{ 'global.condition.text' | translate }}
                  </mat-header-cell>
                  <mat-cell class="ft-12-600" *matCellDef="let data">
                    <span *ngIf="data.conditionCode?.length < 50; else conditionCode">
                      {{ data.conditionCode }}
                    </span>
                    <ng-template #conditionCode>
                      <span [matTooltip]="data.conditionCode" matTooltipPosition="above">
                        {{ data.conditionCode | truncate: 50 }}
                      </span>
                    </ng-template>
                  </mat-cell>
                </ng-container>

                <!-- Weight Column -->
                <ng-container matColumnDef="assignmentWeight">
                  <mat-header-cell class="ft-12-700" *matHeaderCellDef>
                    {{ 'home-global.assignment-weight.text' | translate }}
                  </mat-header-cell>
                  <mat-cell class="ft-12-600" *matCellDef="let data"> {{ data.assignmentWeight }} </mat-cell>
                </ng-container>

                <!-- Description Column -->
                <ng-container matColumnDef="description">
                  <mat-header-cell class="ft-12-700" *matHeaderCellDef>
                    {{ 'global.description.text' | translate }}
                  </mat-header-cell>
                  <mat-cell class="ft-12-600" *matCellDef="let data">
                    <span *ngIf="data.description?.length < 50; else conditionDescription">
                      {{ data.description }}
                    </span>
                    <ng-template #conditionDescription>
                      <span [matTooltip]="data.description" matTooltipPosition="above">
                        {{ data.description | truncate: 50 }}
                      </span>
                    </ng-template>
                  </mat-cell>
                </ng-container>

                <mat-header-row *matHeaderRowDef="displayedConditionColumns"></mat-header-row>
                <mat-row *matRowDef="let row; columns: displayedConditionColumns"></mat-row>
              </mat-table>
            </div>
            <div *ngIf="experiment.type === 'Factorial'">
              <mat-table [dataSource]="conditionDatasource" class="table">
                <!-- Condition Code Column -->
                <ng-container matColumnDef="conditionCode">
                  <mat-header-cell
                    style="justify-content: left; padding-left: 15px"
                    class="ft-12-700"
                    *matHeaderCellDef
                  >
                    {{ 'global.condition.text' | translate }}
                  </mat-header-cell>
                  <mat-cell style="justify-content: left" class="ft-12-600" *matCellDef="let data">
                    <span style="padding-left: 5px" *ngIf="data.conditionCode?.length < 50; else conditionCode">
                      {{ experimentDesignStepperService.trimFactorialConditionName(data.conditionCode) }}
                    </span>
                    <ng-template #conditionCode>
                      <span [matTooltip]="data.conditionCode" matTooltipPosition="above">
                        {{
                          experimentDesignStepperService.trimFactorialConditionName(data.conditionCode) | truncate: 50
                        }}
                      </span>
                    </ng-template>
                  </mat-cell>
                </ng-container>

                <!-- Payload Column -->
                <ng-container matColumnDef="payload">
                  <mat-header-cell class="ft-12-700" *matHeaderCellDef>
                    {{ 'global.payload.text' | translate }}
                  </mat-header-cell>
                  <mat-cell class="ft-12-600" *matCellDef="let data">
                    <span *ngIf="data.payload?.value?.length < 50; else trimmedPayload">
                      {{ data.payload?.value }}
                    </span>
                    <ng-template #trimmedPayload>
                      <span [matTooltip]="data.payload?.value" matTooltipPosition="above">
                        {{ data.payload?.value | truncate: 50 }}
                      </span>
                    </ng-template>
                  </mat-cell>
                </ng-container>

                <!-- Weight Column -->
                <ng-container matColumnDef="assignmentWeight">
                  <mat-header-cell style="justify-content: left" class="ft-12-700" *matHeaderCellDef>
                    {{ 'home-global.assignment-weight.text' | translate }}
                  </mat-header-cell>
                  <mat-cell style="justify-content: left; padding-left: 10px" class="ft-12-600" *matCellDef="let data">
                    {{ data.assignmentWeight }}
                  </mat-cell>
                </ng-container>

                <mat-header-row *matHeaderRowDef="displayedConditionColumnsFactorial"></mat-header-row>
                <mat-row *matRowDef="let row; columns: displayedConditionColumnsFactorial"></mat-row>
              </mat-table>
            </div>
          </div>

          <!-- Payloads Table -->
          <div class="table-container table-container-payloads" *ngIf="experiment.type === 'Simple'">
            <span class="ft-24-700">{{ 'home.view-experiment.experiment-payloads-title.text' | translate }}</span>
            <ng-container *ngIf="simpleExperimentPayloadTableData.length">
              <mat-table [dataSource]="simpleExperimentPayloadTableData" class="table payload-table-overview">
                <ng-container matColumnDef="site">
                  <mat-header-cell class="ft-12-700" *matHeaderCellDef>
                    {{ 'home.view-experiment.experiment-payloads.column-label.site' | translate }}
                  </mat-header-cell>
                  <mat-cell class="ft-12-600" *matCellDef="let rowData">
                    <span [matTooltip]="rowData.site" matTooltipPosition="above">
                      {{ rowData.site | truncate: 50 }}
                    </span>
                  </mat-cell>
                </ng-container>

                <ng-container matColumnDef="target">
                  <mat-header-cell class="ft-12-700" *matHeaderCellDef>
                    {{ 'home.view-experiment.experiment-payloads.column-label.target' | translate }}
                  </mat-header-cell>
                  <mat-cell class="ft-12-600" *matCellDef="let rowData">
                    <span [matTooltip]="rowData.target" matTooltipPosition="above">
                      {{ rowData.target | truncate: 50 }}
                    </span>
                  </mat-cell>
                </ng-container>

                <ng-container matColumnDef="condition">
                  <mat-header-cell class="ft-12-700" *matHeaderCellDef>
                    {{ 'home.view-experiment.experiment-payloads.column-label.condition' | translate }}
                  </mat-header-cell>
                  <mat-cell class="ft-12-600" *matCellDef="let rowData">
                    <span [matTooltip]="rowData.condition" matTooltipPosition="above">
                      {{ rowData.condition | truncate: 50 }}
                    </span>
                  </mat-cell>
                </ng-container>

                <ng-container matColumnDef="payload">
                  <mat-header-cell class="ft-12-700" *matHeaderCellDef>
                    {{ 'home.view-experiment.experiment-payloads.column-label.payload' | translate }}
                  </mat-header-cell>
                  <mat-cell class="ft-12-600" *matCellDef="let rowData">
                    <span [matTooltip]="rowData.payload" matTooltipPosition="above">
                      {{ rowData.payload | truncate: 50 }}
                    </span>
                  </mat-cell>
                </ng-container>

                <mat-header-row *matHeaderRowDef="displayedPayloadConditionColumns"></mat-header-row>
                <mat-row
                  *matRowDef="let row; columns: displayedPayloadConditionColumns"
                  [ngClass]="row?.rowStyle"
                ></mat-row>
              </mat-table>
            </ng-container>
          </div>
        </div>
      </mat-tab>

      <mat-tab label="{{ 'home.view-experiment.mattab.participants.text' | translate }}">
        <div class="tab-body-container tab-table-body-container">
          <!-- Participants to include table -->
          <div class="table-container table-container-participants">
            <span class="ft-24-700">{{ 'segments.include.text' | translate }}</span>
            <mat-table [dataSource]="includeParticipants" class="table">
              <!-- Type Column -->
              <ng-container matColumnDef="participantsType">
                <mat-header-cell class="ft-12-700" *matHeaderCellDef>
                  {{ 'segments.global-members-type.text' | translate }}
                </mat-header-cell>
                <mat-cell class="ft-12-600" *matCellDef="let data">
                  <span *ngIf="data.participant_Type?.length < 50; else participantType">
                    {{ data.participant_Type }}
                  </span>
                  <ng-template #participantType>
                    <span [matTooltip]="data.participant_Type" matTooltipPosition="above">
                      {{ data.participant_Type | truncate: 50 }}
                    </span>
                  </ng-template>
                </mat-cell>
              </ng-container>

              <!-- Name/Id Column -->
              <ng-container matColumnDef="participantsId">
                <mat-header-cell class="ft-12-700" *matHeaderCellDef>
                  {{ 'segments.global-members-id/name.text' | translate }}
                </mat-header-cell>
                <mat-cell class="ft-12-600" *matCellDef="let data">
                  <span *ngIf="data.participant_id?.length < 50; else participantId">
                    {{ data.participant_id }}
                  </span>
                  <ng-template #participantId>
                    <span [matTooltip]="data.participant_id" matTooltipPosition="above">
                      {{ data.participant_id | truncate: 50 }}
                    </span>
                  </ng-template>
                </mat-cell>
              </ng-container>

              <mat-header-row *matHeaderRowDef="displayedParticipantsColumns"></mat-header-row>
              <mat-row *matRowDef="let row; columns: displayedParticipantsColumns"></mat-row>
            </mat-table>
          </div>

          <!-- Participants to exclude table -->
          <div class="table-container table-container-participants">
            <span class="ft-24-700">{{ 'segments.except.text' | translate }}</span>
            <mat-table [dataSource]="excludeParticipants" class="table">
              <!-- Type Column -->
              <ng-container matColumnDef="participantsType">
                <mat-header-cell class="ft-12-700" *matHeaderCellDef>
                  {{ 'home.view-experiment-global.experiment-site.text' | translate }}
                </mat-header-cell>
                <mat-cell class="ft-12-600" *matCellDef="let data">
                  <span *ngIf="data.participant_Type?.length < 50; else participantType">
                    {{ data.participant_Type }}
                  </span>
                  <ng-template #participantType>
                    <span [matTooltip]="data.participant_Type" matTooltipPosition="above">
                      {{ data.participant_Type | truncate: 50 }}
                    </span>
                  </ng-template>
                </mat-cell>
              </ng-container>

              <!-- Name/Id Column -->
              <ng-container matColumnDef="participantsId">
                <mat-header-cell class="ft-12-700" *matHeaderCellDef>
                  {{ 'home.view-experiment-global.experiment-target.text' | translate }}
                </mat-header-cell>
                <mat-cell class="ft-12-600" *matCellDef="let data">
                  <span *ngIf="data.participant_id?.length < 50; else participantId">
                    {{ data.participant_id }}
                  </span>
                  <ng-template #participantId>
                    <span [matTooltip]="data.participant_id" matTooltipPosition="above">
                      {{ data.participant_id | truncate: 50 }}
                    </span>
                  </ng-template>
                </mat-cell>
              </ng-container>

              <mat-header-row *matHeaderRowDef="displayedParticipantsColumns"></mat-header-row>
              <mat-row *matRowDef="let row; columns: displayedParticipantsColumns"></mat-row>
            </mat-table>
          </div>
        </div>
      </mat-tab>

      <mat-tab label="{{ 'home.view-experiment.mattab.metrics.text' | translate }}">
        <div class="tab-body-container tab-table-body-container">
          <!-- Experiment metrics table -->
          <div class="table-container table-container-metrics">
            <span class="ft-24-700">{{ 'home.view-experiment.mattab.metrics.text' | translate }}</span>
            <mat-table [dataSource]="displayMetrics" class="table">
              <!-- Metrics Column -->
              <ng-container matColumnDef="metricsKey">
                <mat-header-cell class="ft-12-700" *matHeaderCellDef>
                  {{ 'query.metric.text' | translate }}
                </mat-header-cell>
                <mat-cell class="ft-12-600" *matCellDef="let data">
                  <div *ngFor="let key of data.metric_Key">
                    <div class="metric-key">
                      {{ key }}
                    </div>
                  </div>
                </mat-cell>
              </ng-container>

              <!-- Statistic Column -->
              <ng-container matColumnDef="metricsOperation">
                <mat-header-cell class="ft-12-700" *matHeaderCellDef>
                  {{ 'monitor.statistic.text' | translate }}
                </mat-header-cell>
                <mat-cell class="ft-12-600" *matCellDef="let data">
                  <div *ngFor="let statisticOperation of data.metric_Operation">
                    <div class="metric-Operation">
                      {{ statisticOperation | titlecase }}
                    </div>
                  </div>
                </mat-cell>
              </ng-container>

              <!-- Display Name Column -->
              <ng-container matColumnDef="metricsName">
                <mat-header-cell class="ft-12-700" *matHeaderCellDef>
                  {{ 'home.new-experiment.metrics.description-header.placeholder.text' | translate }}
                </mat-header-cell>
                <mat-cell class="ft-12-600" *matCellDef="let data">
                  <span *ngIf="data.metric_Name?.length < 50; else displayName">
                    {{ data.metric_Name }}
                  </span>
                  <ng-template #displayName>
                    <span [matTooltip]="data.metric_Name" matTooltipPosition="above">
                      {{ data.metric_Name | truncate: 50 }}
                    </span>
                  </ng-template>
                </mat-cell>
              </ng-container>

              <mat-header-row *matHeaderRowDef="displayedMetricsColumns"></mat-header-row>
              <mat-row *matRowDef="let row; columns: displayedMetricsColumns"></mat-row>
            </mat-table>
          </div>
        </div>
      </mat-tab>

      <mat-tab label="{{ 'home.view-experiment.mattab.data.text' | translate }}">
        <div class="tab-body-container">
          <div class="ft-24-700 enrollment-text">
            {{ 'home.view-experiment.mattab.data.enrollment.text' | translate }}
          </div>
          <div class="ft-12-600 enrollment-details-text">
            {{ 'home.view-experiment.mattab.data.enrollment-detail.text' | translate }}
          </div>

          <!-- Enrollment over time section -->
          <home-enrollment-over-time [experiment]="experiment"></home-enrollment-over-time>

          <!-- Enrollment by condition table -->
          <home-enrollment-condition-table [experiment]="experiment"></home-enrollment-condition-table>

          <ng-container *ngIf="experiment.queries.length">
            <div class="box-shadow"></div>
            <!-- Experiment queries results -->
            <home-experiment-query-result [experiment]="experiment"></home-experiment-query-result>
          </ng-container>
        </div>
      </mat-tab>
    </mat-tab-group>
  </mat-card>
</mat-card>
