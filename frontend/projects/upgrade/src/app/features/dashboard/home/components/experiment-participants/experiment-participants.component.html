<div class="shared-modal--step-container">
  <section class="shared-modal--form-container">
    <form class="experiment-participants" [formGroup]="participantsForm">
      <!-- Table -->
      <div class="property-container">
        <mat-form-field class="ft-14-600 inclusion-criteria">
          <mat-label>{{ 'home-global.inclusion-criteria.text' | translate }}</mat-label>
          <mat-select class="ft-14-400" formControlName="inclusionCriteria">
            <mat-option
              *ngFor="let criteria of inclusionCriteria"
              [value]="criteria.value"
            >
              {{ criteria.value | titlecase }}
            </mat-option>
          </mat-select>
        </mat-form-field>
        <br>
        <span class="title"> {{ 'segments.include.text' | translate }} </span>
        <mat-table
          class="member-table"
          [dataSource]="members1DataSource"
          formArrayName="members1"
          #members1Table
        >
          <!-- Members Type Column -->
          <ng-container matColumnDef="type">
            <mat-header-cell class="ft-14-700" *matHeaderCellDef>
              {{ 'segments.global-members-type.text' | translate }}
            </mat-header-cell>
            <mat-cell
              *matCellDef="let element; let groupIndex = index"
              [formGroupName]="groupIndex"
            >
            <mat-form-field floatLabel="never" class="form-control">
              <mat-label>{{ 'segments.members-placeholder-type.text' | translate }}</mat-label>
              <mat-select formControlName="type">
                <mat-option *ngFor="let val of subSegmentTypes" [value]="val.value">
                  {{ val.name }}
                </mat-option>
              </mat-select>
            </mat-form-field>
            </mat-cell>
          </ng-container>
          <!-- Members Id Column -->
          <ng-container matColumnDef="id">
            <mat-header-cell class="ft-14-700" *matHeaderCellDef>
              {{ 'segments.global-members-id/name.text' | translate }}
            </mat-header-cell>
            <mat-cell
              *matCellDef="let element; let groupIndex = index"
              [formGroupName]="groupIndex"
            >
            <ng-container *ngIf="participantsForm.getRawValue('type')?.members1[groupIndex]?.type === 'Segment'; else noSelect">
              <mat-form-field floatLabel="never" class="form-control">
                <mat-select formControlName="id">
                  <mat-option *ngFor="let subSegmentId of subSegmentIds" [value]="subSegmentId">
                    {{ subSegmentId }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </ng-container>
            <ng-template #noSelect>
              <mat-form-field floatLabel="never" class="form-control">
                <input
                  matInput
                  [placeholder]="'segments.members-placeholder-id/name.text' | translate"
                  formControlName="id"
                  autocomplete="off"
                />
              </mat-form-field>
            </ng-template>
            </mat-cell>
          </ng-container>
          <!-- Members Remove Column -->
          <ng-container matColumnDef="removeMember">
            <mat-header-cell class="ft-14-700" *matHeaderCellDef></mat-header-cell>
            <mat-cell
              style="justify-content: flex-start;"
              *matCellDef="let element; let groupIndex = index"
              [formGroupName]="groupIndex"
            >
              <mat-icon
                class="remove-icon"
                (click)="removeMember1(groupIndex)"
              >
                delete_outline
              </mat-icon>
            </mat-cell>
          </ng-container>
          <mat-header-row *matHeaderRowDef="membersDisplayedColumns; sticky: true"></mat-header-row>
          <mat-row *matRowDef="let row; columns: membersDisplayedColumns"></mat-row>
        </mat-table>
        <span
          class="ft-14-600 validation-message"
          *ngIf="IncludeEmptyRowError"
          [innerHTML]="EmptyRowErrorMsg"
        ></span>
        <button
          type="button"
          class="ft-12-700 add-member"
          (click)="addMember1()"
        >
          + {{ 'segments.members-add-members.text' | translate }}
        </button>
        <br>
      </div>
    </form>
    <br>
    <br>
    <form class="experiment-participants" [formGroup]="participantsForm2">
      <div class="property-container">
        <ng-container *ngIf="inclusionCriterisAsIncludeSpecific">
        <span class="title"> {{ 'segments.except.text' | translate }} </span>
        <mat-table
          class="member-table"
          [dataSource]="members2DataSource"
          formArrayName="members2"
          #members2Table
        >
          <!-- Members NUMBER Column -->
          <ng-container matColumnDef="memberNumber">
            <mat-header-cell class="ft-14-700" *matHeaderCellDef>
              {{ 'global.number.text' | translate }}
            </mat-header-cell>
            <mat-cell *matCellDef="let element; let groupIndex = index">
              <span>{{ groupIndex + 1 }}</span>
            </mat-cell>
          </ng-container>

          <!-- Members Type Column -->
          <ng-container matColumnDef="type">
            <mat-header-cell class="ft-14-700" *matHeaderCellDef>
              {{ 'segments.global-members-type.text' | translate }}
            </mat-header-cell>
            <mat-cell
              *matCellDef="let element; let groupIndex = index"
              [formGroupName]="groupIndex"
            >
            <mat-form-field floatLabel="never" class="form-control">
              <mat-label>{{ 'segments.members-placeholder-type.text' | translate }}</mat-label>
              <mat-select formControlName="type">
                <mat-option *ngFor="let val of subSegmentTypes" [value]="val.value">
                  {{ val.name }}
                </mat-option>
              </mat-select>
            </mat-form-field>
            </mat-cell>
          </ng-container>
          <!-- Members Id Column -->
          <ng-container matColumnDef="id">
            <mat-header-cell class="ft-14-700" *matHeaderCellDef>
              {{ 'segments.global-members-id/name.text' | translate }}
            </mat-header-cell>
            <mat-cell
              *matCellDef="let element; let groupIndex = index"
              [formGroupName]="groupIndex"
            >
            <ng-container *ngIf="participantsForm2.getRawValue('type')?.members2[groupIndex]?.type === 'Segment'; else noSelect">
              <mat-form-field floatLabel="never" class="form-control">
                <mat-select formControlName="id">
                  <mat-option *ngFor="let subSegmentId of subSegmentIds" [value]="subSegmentId">
                    {{ subSegmentId }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </ng-container>
            <ng-template #noSelect>
              <mat-form-field floatLabel="never" class="form-control">
                <input
                  matInput
                  [placeholder]="'segments.members-placeholder-id/name.text' | translate"
                  formControlName="id"
                  autocomplete="off"
                />
              </mat-form-field>
            </ng-template>
            </mat-cell>
          </ng-container>
          <!-- Members Remove Column -->
          <ng-container matColumnDef="removeMember">
            <mat-header-cell class="ft-14-700" *matHeaderCellDef></mat-header-cell>
            <mat-cell
              style="justify-content: flex-start;"
              *matCellDef="let element; let groupIndex = index"
              [formGroupName]="groupIndex"
            >
              <mat-icon
                class="remove-icon"
                (click)="removeMember2(groupIndex)"
              >
                delete_outline
              </mat-icon>
            </mat-cell>
          </ng-container>
          <mat-header-row *matHeaderRowDef="membersDisplayedColumns; sticky: true"></mat-header-row>
          <mat-row *matRowDef="let row; columns: membersDisplayedColumns"></mat-row>
        </mat-table>
        <span
          class="ft-14-600 validation-message"
          *ngIf="ExcludeEmptyRowError"
          [innerHTML]="EmptyRowErrorMsg"
        ></span>
        <button
          type="button"
          class="ft-12-700 add-member"
          (click)="addMember2()"
        >
          + {{ 'segments.members-add-members.text' | translate }}
        </button>
        </ng-container>
        <!-- <br> -->

      </div>
    </form>
  </section>

  <section class="shared-modal--buttons-container">
    <span class="shared-modal--buttons-left">
      <button
        matStepperPrevious
        mat-raised-button
        class="shared-modal--modal-btn btn-back default-button"
      >
        {{ 'global.back.text' | translate }}
      </button>
    </span>
    <span class="shared-modal--buttons-right">
      <button
        type="button"
        mat-raised-button
        class="shared-modal--modal-btn"
        (click)="emitEvent(NewExperimentDialogEvents.CLOSE_DIALOG)"
      >
        {{ 'global.cancel.text' | translate }}
      </button>
      <button
        type="button"
        mat-raised-button
        class="shared-modal--modal-btn default-button"
        (click)="emitEvent(NewExperimentDialogEvents.SEND_FORM_DATA)"
      >
        {{ 'global.next.text' | translate }}
      </button>
      <button
        type="button"
        *ngIf="experimentInfo && enableSave"
        mat-raised-button
        class="shared-modal--modal-btn default-button"
        (click)="emitEvent(NewExperimentDialogEvents.SAVE_DATA)"
      >
        {{ 'global.update.text' | translate }}
      </button>
    </span>
  </section>
</div>
