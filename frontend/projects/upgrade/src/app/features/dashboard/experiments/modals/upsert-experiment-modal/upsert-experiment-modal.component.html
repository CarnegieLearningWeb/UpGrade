<app-common-dialog
  [title]="config.title"
  [cancelBtnLabel]="config.cancelBtnLabel"
  [primaryActionBtnLabel]="config.primaryActionBtnLabel"
  [primaryActionBtnColor]="config.primaryActionBtnColor"
  [primaryActionBtnDisabled]="isPrimaryButtonDisabled$ | async"
  (primaryActionBtnClicked)="onPrimaryActionBtnClicked()"
>
  <form [formGroup]="experimentForm" class="form-standard dense-3">
    <mat-form-field appearance="outline">
      <mat-label class="ft-14-400">Name</mat-label>
      <input matInput formControlName="name" placeholder="e.g., My experiment" class="ft-14-400" />
      <mat-hint class="form-hint ft-12-400">
        {{ 'experiments.upsert-experiment-modal.name-hint.text' | translate }}
      </mat-hint>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label class="ft-14-400">Description (optional)</mat-label>
      <input matInput formControlName="description" placeholder="Describe your experiment" class="ft-14-400" />
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label class="ft-14-400">App Context</mat-label>
      <mat-select formControlName="appContext" class="ft-14-400">
        <mat-option *ngFor="let context of allContexts" [value]="context" class="ft-14-400">{{
          context
        }}</mat-option>
      </mat-select>
      <mat-hint
        *ngIf="!(config.params.action === UPSERT_EXPERIMENT_ACTION.EDIT && isContextChanged)"
        class="form-hint ft-12-400"
      >
        {{ 'experiments.upsert-experiment-modal.app-context-hint.text' | translate }}
        <a class="learn-more-link" href="https://www.upgradeplatform.org/" target="_blank" rel="noopener noreferrer">
          Learn more
        </a>
      </mat-hint>
      <mat-hint
        *ngIf="config.params.action === UPSERT_EXPERIMENT_ACTION.EDIT && isContextChanged"
        class="form-hint ft-12-400 warning-hint"
      >
        {{ 'experiments.upsert-experiment-modal.app-context-warning.text' | translate }}
      </mat-hint>
    </mat-form-field>

    <div class="experiment-type-section dense-1">
      <mat-radio-group formControlName="experimentType">
        <span class="section-label ft-14-600">Experiment Type</span>
        <mat-radio-button
          *ngFor="let type of experimentTypes"
          [value]="type.value"
          [disabled]="type.disabled"
        >
          <div class="radio-content">
            <span
              class="radio-label ft-14-600"
              [class.disabled-text]="type.disabled"
            >
              {{ type.value + ' Experiment' }}
            </span>
            <span
              class="radio-description ft-12-400"
              [class.disabled-text]="type.disabled"
            >
              {{ type.description | translate }}
            </span>
          </div>
        </mat-radio-button>
      </mat-radio-group>
    </div>

    <div class="unit-assignment-section dense-1">
      <mat-radio-group formControlName="unitOfAssignment">
        <span class="section-label ft-14-600">Unit of Assignment</span>
        <mat-radio-button *ngFor="let unit of unitOfAssignments" [value]="unit.value">
          <div class="radio-content">
            <span class="radio-label ft-14-600">{{ unit.value | titlecase }}</span>
            <span class="radio-description ft-12-400">{{ unit.description | translate }}</span>
          </div>
        </mat-radio-button>
      </mat-radio-group>
    </div>

    <mat-form-field
      *ngIf="unitOfAssignmentValue === ASSIGNMENT_UNIT.GROUP"
      appearance="outline"
      subscriptSizing="dynamic"
    >
      <mat-label class="ft-14-400">Group Type</mat-label>
      <mat-select formControlName="groupType" class="ft-14-400">
        <mat-option *ngFor="let group of groupTypes" [value]="group.value" class="ft-14-400">
          {{ group.value }}
        </mat-option>
      </mat-select>
      <mat-hint class="form-hint ft-12-400">
        {{ 'experiments.upsert-experiment-modal.group-type-hint.text' | translate }}
      </mat-hint>
    </mat-form-field>

    <div class="consistency-rule-section dense-1" *ngIf="unitOfAssignmentValue !== ASSIGNMENT_UNIT.WITHIN_SUBJECTS">
      <mat-radio-group formControlName="consistencyRule">
        <span class="section-label ft-14-600">Consistency Rule</span>
        <mat-radio-button
          *ngFor="let rule of consistencyRules"
          [value]="rule.value"
          [disabled]="rule.disabled"
        >
          <div class="radio-content">
            <span
              class="radio-label ft-14-600"
              [class.disabled-text]="rule.disabled"
            >
              {{ rule.value | titlecase }}
            </span>
            <span
              class="radio-description ft-12-400"
              [class.disabled-text]="rule.disabled"
            >
              {{ rule.description | translate }}
            </span>
          </div>
        </mat-radio-button>
      </mat-radio-group>
    </div>

    <div class="condition-order-section dense-1" *ngIf="unitOfAssignmentValue === ASSIGNMENT_UNIT.WITHIN_SUBJECTS">
      <mat-radio-group formControlName="conditionOrder">
        <span class="section-label ft-14-600">Condition Order</span>
        <mat-radio-button *ngFor="let order of conditionOrders" [value]="order.value">
          <div class="radio-content">
            <span class="radio-label ft-14-600">{{ order.value | titlecase }}</span>
            <span class="radio-description ft-12-400">{{ order.description | translate }}</span>
          </div>
        </mat-radio-button>
      </mat-radio-group>
    </div>

    <div class="assignment-algorithm-section dense-1">
      <mat-radio-group formControlName="assignmentAlgorithm">
        <span class="section-label ft-14-600">Assignment Algorithm</span>
        <mat-radio-button
          *ngFor="let algorithm of assignmentAlgorithms"
          [value]="algorithm.value"
          [disabled]="algorithm.disabled"
        >
          <div class="radio-content">
            <span
              class="radio-label ft-14-600"
              [class.disabled-text]="algorithm.disabled"
            >
              {{ ASSIGNMENT_ALGORITHM_DISPLAY_MAP[algorithm.value] }}
            </span>
            <span
              class="radio-description ft-12-400"
              [class.disabled-text]="algorithm.disabled"
            >
              {{ algorithm.description | translate }}
            </span>
          </div>
        </mat-radio-button>
      </mat-radio-group>
    </div>

    <mat-form-field
      *ngIf="assignmentAlgorithmValue === ASSIGNMENT_ALGORITHM.STRATIFIED_RANDOM_SAMPLING"
      appearance="outline"
      subscriptSizing="dynamic"
    >
      <mat-label class="ft-14-400">Stratification Factor</mat-label>
      <mat-select formControlName="stratificationFactor" class="ft-14-400">
        <mat-option
          *ngFor="let factor of allStratificationFactors"
          [value]="factor.factorName"
          class="ft-14-400"
        >
          {{ factor.factorName }}
        </mat-option>
      </mat-select>
      <mat-hint class="form-hint ft-12-400">
        {{ 'experiments.upsert-experiment-modal.stratification-factor-hint.text' | translate }}
      </mat-hint>
    </mat-form-field>

    <app-common-tags-input
      formControlName="tags"
      [inputType]="CommonTagInputType.TAGS"
      [label]="config.tagsLabel"
      [placeholder]="config.tagsPlaceholder"
    ></app-common-tags-input>
  </form>
</app-common-dialog>
